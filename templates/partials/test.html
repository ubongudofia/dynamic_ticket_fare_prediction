<!-- <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

</head>

<body>


    
    <div class="charts">

        <div class="charts-card">
            <div id="line-chart"></div>
        </div>

        <div class="charts-card">
            <p class="chart-title">Payments and Tickets</p>
            <div id="bar-chart"></div>
        </div>

    </div><br><br> -->


    <div class="table-container">
        <main class="table" id="customers_table">
            <section class="table__header">
                <h1>Registered Users</h1>
                <div class="input-group">
                    <input type="search" placeholder="Search Data...">
                    <img src="{{ url_for('static', filename='images/search.png') }}" alt="">
                </div>
                <div class="export__file">
                    <label for="export-file" class="export__file-btn" title="Export File"></label>
                    <input type="checkbox" id="export-file">
                    <div class="export__file-options">
                        <label>Export As &nbsp; &#10140;</label>
                        <label for="export-file" id="toPDF">PDF <img
                                src="{{ url_for('static', filename='images/pdf.png') }}" alt=""></label>
                        <label for="export-file" id="toJSON">JSON <img
                                src="{{ url_for('static', filename='images/json.png') }}" alt=""></label>
                        <label for="export-file" id="toCSV">CSV <img
                                src="{{ url_for('static', filename='images/csv.png') }}" alt=""></label>
                        <label for="export-file" id="toEXCEL">EXCEL <img
                                src="{{ url_for('static', filename='images/excel.png') }}" alt=""></label>
                    </div>
                </div>
            </section>

            <section class="table__body">
                <label for="filter">Filter by Status:</label>
                <select id="filter">
                    <option value="All">All</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
                <table id="userTable">
                    <thead>
                        <tr>
                            <th> Profile Picture <span class="icon-arrow">&UpArrow;</span></th>
                            <th> Firstname <span class="icon-arrow">&UpArrow;</span></th>
                            <th> Lastname <span class="icon-arrow">&UpArrow;</span></th>
                            <th> Email <span class="icon-arrow">&UpArrow;</span></th>
                            <th> Phone Number <span class="icon-arrow">&UpArrow;</span></th>
                            <th> Role <span class="icon-arrow">&UpArrow;</span></th>
                            <th> Status <span class="icon-arrow">&UpArrow;</span></th>
                            <th> Action <span class="icon-arrow">&UpArrow;</span></th>
                        </tr>
                    </thead>
                    <tbody id="userBody">
                    </tbody>
                </table>
            </section>
        </main>

    </div>

<!-- 
</body>

</html>

<script>



document.addEventListener("DOMContentLoaded", function () {
    // Minimal test data
    const testData = [
        { x: new Date("2023-09-21").getTime(), y: 1 },
        { x: new Date("2024-05-30").getTime(), y: 2 },
        { x: new Date("2024-12-14").getTime(), y: 3 }
    ];

    // Chart options
    const options = {
        chart: {
            type: "line",
            height: 350
        },
        series: [{ name: "Test Data", data: testData }],
        xaxis: { type: "datetime" }
    };

    // Render the chart
    const chartElement = document.querySelector("#line-chart");
    if (chartElement) {
        const chart = new ApexCharts(chartElement, options);
        chart.render();
    } else {
        console.error("Chart element not found.");
    }
});
 -->


 // let chart = null;

 // async function fetchUserRegistrationTrend() {
 //     try {
 //         const response = await fetch("http://127.0.0.1:5009/user_registration_trend");
 //         if (!response.ok) {
 //             throw new Error(`HTTP error! Status: ${response.status}`);
 //         }
 //         const data = await response.json();
 
 //         console.log("Raw Data from Backend:", data);
 
 //         if (!data.dates || !Array.isArray(data.dates)) {
 //             console.error("Invalid data format:", data);
 //             return;
 //         }
 
 //         let seriesData = {};
 //         data.dates.sort().forEach(date => {
 //             seriesData[date] = (seriesData[date] || 0) + 1;
 //         });
 
 //         console.log("Series Data:", seriesData);
 
 //         let chartSeries = Object.entries(seriesData).map(([date, count]) => ({
 //             x: new Date(date).getTime(),
 //             y: count
 //         }));
 
 //         console.log("Processed Chart Data:", chartSeries);
 
 //         if (chartSeries.length === 0) {
 //             console.error("No valid data to display.");
 //             return;
 //         }
 
 //         let chartElement = document.querySelector("#line-chart");
 //         if (!chartElement) {
 //             console.error("Chart element not found.");
 //             return;
 //         }
 
 //         var options = {
 //             chart: {
 //                 type: "line",
 //                 height: 350,
 //                 animations: {
 //                     enabled: false // Disable animations for debugging
 //                 }
 //             },
 //             series: [{ name: "Registrations", data: chartSeries }],
 //             xaxis: {
 //                 type: "datetime",
 //                 labels: {
 //                     format: "yyyy-MM-dd" // Format x-axis labels
 //                 }
 //             },
 //             tooltip: {
 //                 x: {
 //                     format: "yyyy-MM-dd" // Format tooltip dates
 //                 }
 //             }
 //         };
 
 //         if (chart) {
 //             chart.destroy();
 //         }
 
 //         chart = new ApexCharts(chartElement, options);
 //         chart.render();
 
 //     } catch (error) {
 //         console.error("Error fetching user registration trend:", error);
 //     }
 // }
 
 // document.addEventListener("DOMContentLoaded", function () {
 //     fetchUserRegistrationTrend();
 //     setInterval(fetchUserRegistrationTrend, 30000);
 // });
 
 
 
 
 
 
 // let chart = null;  // Declare globally to avoid ReferenceError
 
 // async function fetchUserRegistrationTrend() {
 //     try {
 //         const response = await fetch("http://127.0.0.1:5009/user_registration_trend");
 //         const data = await response.json();
 
 //         if (!data.dates || !Array.isArray(data.dates)) {
 //             console.error("Invalid data format:", data);
 //             return;
 //         }
 
 //         let seriesData = {};
 //         data.dates.sort().forEach(date => {
 //             seriesData[date] = (seriesData[date] || 0) + 1;
 //         });
 
 //         let chartSeries = Object.entries(seriesData).map(([date, count]) => ({
 //             x: new Date(date).getTime(),
 //             y: count
 //         }));
 
 //         console.log("Processed Chart Data:", chartSeries);
 
 //         let chartElement = document.querySelector("#line-chart");
 //         if (!chartElement) {
 //             console.error("Chart element not found.");
 //             return;
 //         }
 
 //         var options = {
 //             chart: {
 //                 type: "line",
 //                 height: 350
 //             },
 //             series: [{ name: "Registrations", data: chartSeries }],
 //             xaxis: { type: "datetime" }
 //         };
 
 //         // If a chart already exists, destroy it before re-creating
 //         if (chart) {
 //             chart.destroy();  // Destroy existing chart before re-creating
 //         }
 
 //         chart = new ApexCharts(chartElement, options);
 //         chart.render();
 
 //     } catch (error) {
 //         console.error("Error fetching user registration trend:", error);
 //     }
 // }
 
 // // Run function when the page loads
 // fetchUserRegistrationTrend();
 
 // // Set interval to refresh every 30 seconds
 // setInterval(fetchUserRegistrationTrend, 30000);
 
 
 
     // let chart; // Declare chart variable globally
 
     // async function fetchUserRegistrationTrend() {
     //     try {
     //         const response = await fetch("http://127.0.0.1:5009/user_registration_trend");
     //         const data = await response.json();
 
     //         if (data.error) {
     //             console.error("Error fetching data:", data.error);
     //             return;
     //         }
 
     //         // Ensure `dates` array exists and is valid
     //         if (!data.dates || !Array.isArray(data.dates)) {
     //             console.error("Invalid data format:", data);
     //             return;
     //         }
 
     //         // Convert to format required by ApexCharts
     //         let seriesData = {};
     //         data.dates.forEach(date => {
     //             seriesData[date] = (seriesData[date] || 0) + 1;
     //         });
 
     //         // Convert series data to ApexCharts format
     //         let chartSeries = Object.entries(seriesData).map(([date, count]) => ({
     //             x: new Date(date).getTime(),
     //             y: count
     //         }));
 
     //         // Ensure element exists before rendering
     //         let chartElement = document.querySelector("#line-chart");
     //         if (!chartElement) {
     //             console.error("Chart element not found.");
     //             return;
     //         }
 
     //         // Chart options
     //         var options = {
     //             chart: {
     //                 type: "line",
     //                 height: 350
     //             },
     //             series: [{
     //                 name: "Registrations",
     //                 data: chartSeries
     //             }],
     //             xaxis: {
     //                 type: "datetime",
     //                 labels: {
     //                     format: "yyyy-MM-dd"
     //                 }
     //             }
     //         };
 
     //         // If chart exists, update it; otherwise, create a new one
     //         if (chart) {
     //             chart.updateSeries([{ name: "Registrations", data: chartSeries }]);
     //         } else {
     //             chart = new ApexCharts(chartElement, options);
     //             chart.render();
     //         }
 
     //     } catch (error) {
     //         console.error("Error fetching user registration trend:", error);
     //     }
     // }
 
     // // Run function when the page loads
     // fetchUserRegistrationTrend();
 
     // // Set interval to refresh every 30 seconds
     // setInterval(fetchUserRegistrationTrend, 30000);
 
 
 
 
 
     // var options = {
     //       series: [{
     //         name: "Desktops",
     //         data: [10, 41, 35, 51, 49, 62, 69, 91, 148]
     //     }],
     //       chart: {
     //       height: 350,
     //       type: 'line',
     //       zoom: {
     //         enabled: false
     //       }
     //     },
     //     dataLabels: {
     //       enabled: false
     //     },
     //     stroke: {
     //       curve: 'straight'
     //     },
     //     title: {
     //       text: 'Product Trends by Month',
     //       align: 'left'
     //     },
     //     grid: {
     //       row: {
     //         colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
     //         opacity: 0.5
     //       },
     //     },
     //     xaxis: {
     //       categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
     //     }
     //     };
 
     //     var chart = new ApexCharts(document.querySelector("#line-chart"), options);
     //     chart.render();
       
 
 
 
 
 
 
 
 
     // // // ---------- CHARTS ----------
 
     // // BAR CHART
     // const barChartOptions = {
     //     series: [
     //         {
     //             data: [10, 8, 6, 4, 2],
     //         },
     //     ],
     //     chart: {
     //         type: 'bar',
     //         height: 350,
     //         toolbar: {
     //             show: false,
     //         },
     //     },
     //     colors: ['#246dec', '#cc3c43', '#367952', '#f5b74f', '#4f35a1'],
     //     plotOptions: {
     //         bar: {
     //             distributed: true,
     //             borderRadius: 4,
     //             horizontal: false,
     //             columnWidth: '40%',
     //         },
     //     },
     //     dataLabels: {
     //         enabled: false,
     //     },
     //     legend: {
     //         show: false,
     //     },
     //     xaxis: {
     //         categories: ['Laptop', 'Phone', 'Monitor', 'Headphones', 'Camera'],
     //     },
     //     yaxis: {
     //         title: {
     //             text: 'Count',
     //         },
     //     },
     // };
 
     // const barChart = new ApexCharts(
     //     document.querySelector('#bar-chart'),
     //     barChartOptions
     // );
     // barChart.render();
 
     document.addEventListener("DOMContentLoaded", function () {
     const tableBody = document.getElementById("userBody");
     const filterDropdown = document.getElementById("filter");
 
     function getStatusClass(status) {
         return status === "Active" ? "active" : status === "Inactive" ? "inactive" : "";
     }
 
     function getRoleClass(role) {
         return role === "Passenger" ? "passenger" : role === "Admin" ? "admin" : "";
     }
 
     function fetchUsers() {
         fetch("/get_users")
             .then(response => {
                 if (!response.ok) throw new Error("Failed to fetch users");
                 return response.json();
             })
             .then(data => {
                 const selectedStatus = filterDropdown.value;
                 tableBody.innerHTML = "";
 
                 const filteredUsers = selectedStatus === "All"
                     ? data
                     : data.filter(user => user.status === selectedStatus);
 
                 filteredUsers.forEach(user => {
                     const profileImageUrl = user._id ? `/profile_picture/${user._id}` : "default.jpg"; // Handle missing ID
 
                     const row = document.createElement("tr");
                     row.innerHTML = `
                         <td><img src="${profileImageUrl}" alt="Profile" width="40"></td>
                         <td>${user.firstname || "N/A"}</td>
                         <td>${user.lastname || "N/A"}</td>
                         <td>${user.email || "N/A"}</td>
                         <td>${user.phone || "N/A"}</td>
                         <td class="action">
                             <span class="status ${getRoleClass(user.role)}">${user.role || "Unknown"}</span>
                         </td>
                         <td class="action">
                             <span class="status ${getStatusClass(user.status)}">${user.status || "Unknown"}</span>
                         </td>
                         <td class="action">
                             <a href="/edit_user/${user._id}" class="edit">Edit</a>
                             <a href="/delete_user/${user._id}" class="delete">Delete</a>
                         </td>
                     `;
                     tableBody.appendChild(row);
                 });
             })
             .catch(error => console.error("Error fetching users:", error));
     }
 
     fetchUsers();
     setInterval(fetchUsers, 5000);
     filterDropdown.addEventListener("change", fetchUsers);
 });
 
 </script>
 